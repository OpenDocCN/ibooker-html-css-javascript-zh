# 前置内容

## 前言

《测试 JavaScript 应用程序》是我六年前希望读过的测试书籍。当时，我是一个质量保证（QA）实习生。这是我第一次进入软件行业。不幸的是，它并没有要求我去做我最喜欢的事情：在键盘上施展咒语。相反，我不得不手动浏览屏幕，点击按钮，填写表格，并确保我们构建的软件按预期工作。

“一定有更好的方法，”我想。于是我开始为机器编写咒语，以解放我成为我想成为的创造性巫师。

经过 18 个月后，我认为我已经弄懂了大部分内容。那时，我已经通过自动化自己从 QA 角色转变为软件工程师。

一旦我开始编写应用程序，我脑海中就出现了更多问题。在 QA 领域投入了相当长的时间后，我不想依赖他人构建出能正常工作的软件。我也不想浪费我宝贵的咒语制作时间点击按钮和填写表格，就像我过去做的那样。

再次，我认为“一定有更好的方法。”那时我开始阅读更多关于软件测试的内容。现在我有权访问源代码，我发现我可以更有信心、更快速地构建软件。此外，我可以解放我的质量保证（QA）朋友们，让他们能够进行更多创造性和主动性的工作，而不仅仅是将软件推给他们手动测试。

困难的部分是找到能够教我如何做到的材料。尽管我有时可以在网上找到有用的文章，但其中大部分已经过时或只关注测试难题的一小部分。

将这些碎片组合在一起是学习软件测试最具挑战性的部分。软件工程师是否应该始终编写测试？如果是这样，应该编写哪些类型的测试，为什么，以及多少？软件开发和 QA 如何结合？

多年前，没有一篇内容能够回答所有这些问题。我想读的那本书不存在；因此，我决定自己写。

虽然好的内容散布在互联网的各个角落，但其中很大一部分仍然没有写成文字。测试难题的大部分仍然在那些维护他人使用的测试库的人的大脑中处于无结构状态。

在《测试 JavaScript 应用程序》中，我将这些碎片以可理解的方式组合在一起。我将我从多年阅读和实践工作经验中学到的知识与我维护数百万用户使用的测试库（如 Chai 和 Sinon）时所发现的知识结合起来。

我坚信，优秀的测试实践是每件成功软件的核心。这些实践帮助人们以更短的时间、更少的金钱编写出更好的软件。最重要的是，它们使我们摆脱了繁琐的工作，给我们时间去做我们最擅长的事情：创造软件，对我来说，这仍然很大程度上像魔法一样。

## 致谢

我母亲的闹钟总是在早上 6:00 之前响起，就像我的闹钟一样。如果没有她，我不知道我怎么能写出你即将读到的 500 页内容，其中大部分是在世界沉睡时写成的。我的母亲教会了我纪律和努力的价值，我非常感激这一点。

就像她一样，许多其他人也值得我感谢他们教给我的课程和给予我的帮助。

在这些人中，我最想感谢的是我的家人，他们在大西洋的另一边为我加油。我的父亲，Hercílio，他总是说他支持我去做任何我想做的事情；我的妹妹，Luiza，是我认识的最善良的人；还有我的母亲，Patrícia，我在第一段就赞扬了她的辛勤工作。

除了他们，我还要感谢我的祖父母，他们在我父母工作的时候照顾我，尤其是我的祖母，Marli Teixeira da Costa，我将这本书献给她。

无论在巴西的过去有多么艰难，她总是尽她所能为我提供工作所需的一切，从书籍到电脑。在工作日，她通常会为我准备午餐，并在我家附近的大学里为我提供一间房间，这样我就可以休息，以便在课堂上集中注意力。

除了我的家人，还有一些人没有他们，我就无法完成这项工作：Douglas Melo 和 Lorenzo Garibotti，他们教会了我真正的友谊意味着什么；Ana Zardo，她让我意识到世界比我想象的要大；我的治疗师 Alex Monk，他帮助我应对变化并处理我频繁的存在的危机；以及 Gideon Farrell，他带我来到伦敦，并继续信任我，帮助我做到最好。

我还必须感谢多年来 JavaScript 开源社区的所有人，他们教会了我很多东西：我在大学遇到的 Lucas Vieira，他是我知道的最有才华的工程师之一；Carl-Erik Kopseng，他把我带入 Sinon.js，并在 2017 年与我一起工作；以及邀请我成为 Chai.js 核心维护者的 Keith Cirkel，他一直是一个支持我的朋友。当我三年前搬到英国时，他帮助我保持稳定。我很高兴互联网让我与这样出色的人联系在一起！

向所有审稿人致谢：Sergio Arbeo、Jeremy Chen、Giuseppe De Marco、Lucian Enache、Foster Haines、Giampiero Granatella、Lee Harding、Joanna Kupis、Charles Lam、Bonnie Malec、Bryan Miller、Barnaby Norman、Prabhuti Prakash、Dennis Reil、Satej Sahu、Liza Sessler、Raul Siles、Ezra Simeloff、Deniz Vehbi、Richard B. Ward 和 Rodney Weis，你们的建议帮助使这本书变得更好。

最后，我要感谢我的编辑和 Manning 团队，Helen Stergius、Dennis Sellinger 和 Srihari Sridharan，他们审阅了每一页，并耐心回答我在整个过程中提出的无数问题。

Obrigado.

## 关于这本书

《Testing JavaScript Applications》使用实际示例教你如何测试你的 JavaScript 代码，并解释了在决定编写哪些测试以及何时编写测试时应考虑哪些因素。

除了涵盖最流行的 JavaScript 测试工具和测试最佳实践，本书还解释了不同类型的测试如何相互补充，以及它们如何融入你的开发过程，以便你可以在更短的时间内、以更少的错误和更大的信心构建更好的软件。

### 应该阅读这本书的人

我主要写了《Testing JavaScript Applications》这本书是为了给初级开发人员和那些认为“必须有一种更好的方法”来构建工作软件但尚未弄清楚*如何*的软件工程师。

本书假设读者已经能够编写代码，但不需要任何关于软件测试的先验知识。

除了涵盖编写测试的实用方面，它还解释了为什么测试很重要以及它们如何影响你的项目，并赋予你根据*你的*情况做出最佳可能决策的能力。

### 本书是如何组织的：路线图

本书包含 12 章，分为三个部分。

《Testing JavaScript Applications》的第一部分涵盖了自动化测试是什么，为什么它们很重要，不同类型的自动化测试，以及每种类型的测试如何影响你的项目。

+   第一章解释了什么是自动化测试以及编写它们的优点。

+   第二章涵盖了不同类型的自动化测试，并教你每种测试的优缺点，这样你就知道在决定编写哪些测试时要考虑什么。此外，它还教你可以应用于所有类型测试的基本模式。

第二部分使用实际示例教你如何编写你在第一部分中学到的不同类型的测试。

+   第三章涵盖了帮助你最大限度地利用测试的测试技术。它教你如何在测试套件中组织多个测试以获得精确的反馈，如何编写详尽的断言以捕获更多错误，以及测试期间你应该隔离代码的哪些部分。此外，它解释了代码覆盖率是什么以及如何衡量它，并展示了它有时可能具有误导性。

+   第四章教授如何为后端应用程序编写测试。它涵盖了你应该考虑的使你的应用程序可测试的基本方面，演示了如何测试你的服务器路由及其中间件，以及如何处理外部依赖项，如数据库或第三方 API。

+   第五章介绍了帮助您降低后端测试成本、使它们更快、更可靠的技术。它通过教你如何消除不可预测的测试、如何并行运行测试以及如何减少它们之间重叠的方式来实现。

+   第六章描述了如何测试纯 JavaScript 前端应用程序。本章解释了如何在测试框架内模拟浏览器环境，并演示了如何编写与你的应用程序界面交互、与浏览器 API 交互以及处理 HTTP 请求和 WebSockets 的测试。

+   第七章涵盖了 React 测试生态系统。它基于前一章所学内容，解释了 React 应用程序的测试是如何工作的。此外，它为你概述了你可以用来测试 React 应用程序的不同工具，并演示了如何编写你的第一个 React 测试。此外，它还提供了如何将类似技术应用于其他 JavaScript 库和框架的技巧。

+   第八章深入探讨了测试 React 应用程序的实践。在本章中，我将解释如何测试相互交互的组件，如何测试组件的样式，以及快照测试是什么，以及决定是否应该使用它时需要考虑什么。此外，你还将了解组件级验收测试的重要性，以及这种实践如何帮助你更快地构建更好的 React 应用程序。

+   第九章讲述了测试驱动开发（TDD）。它解释了如何应用这种软件开发技术，为什么采用它是有益的，以及在何时进行。除了涵盖 TDD 的实践方面，它还解释了这种技术如何影响团队，以及如何创造一个 TDD 可以成功的环境。它还涵盖了 TDD 与一种称为行为驱动开发（BDD）的实践的关系，这有助于改善不同利益相关者之间的沟通，并提高你的软件质量。

+   第十章描述了基于 UI 的端到端测试是什么，以及它们如何影响你的业务。它还解释了这些测试与其他类型测试的不同之处，并教你如何决定何时编写它们。

+   第十一章涵盖了基于 UI 的端到端测试的实践方面。本章将教你如何编写你的第一个基于 UI 的端到端测试，如何使它们健壮和可靠，以及如何在多个浏览器上运行它们。此外，它描述了如何将视觉回归测试纳入你的测试中，并解释了这种新型测试可能如何有帮助。

第三部分涵盖了可以放大编写测试对业务产生积极影响的互补技术。

+   第十二章描述了持续集成和持续交付是什么，以及为什么它们是有益的技术，并解释了在项目中应用它们所需了解的基本要素。

+   第十三章涵盖了与测试互补的技术、工具和技术。它讨论了类型如何帮助你捕获错误并使你的测试更高效，解释了代码审查如何提高你的代码质量，并涵盖了文档和监控在构建工作软件中的影响。此外，它描述了如何更快、更有信心地调试你的代码。

我建议读者在阅读其他章节之前，先顺序阅读前三章。这几章介绍了基本的测试概念以及它们之间的关系。阅读这些章节是至关重要的，因为您将需要其中的信息来充分利用任何后续章节。

然后，读者可以直接跳转到他们最感兴趣的章节，具体取决于他们想要测试的软件类型。

理想情况下，读者应该在已经实施测试并希望了解如何补充他们的测试技术和基础设施之后，才阅读第十二章和第十三章。

### 关于代码

《测试 JavaScript 应用程序》包含许多实用示例。所有这些示例都可以在本书的 GitHub 仓库中找到，读者可以在[`github.com/lucasfcosta/testing-javascript-applications`](https://github.com/lucasfcosta/testing-javascript-applications)找到该仓库。在那个仓库中，我已经将示例分到了每个章节的文件夹中。在每个章节的文件夹内，我已经根据部分对示例进行了分组。

内联代码和单独的代码列表都使用与这个类似的`固定宽度字体`格式化，以便您能够将其与普通文本区分开来。有时代码也会被**`加粗`**以突出显示与章节中先前步骤相比已更改的代码，例如当新功能添加到现有代码行时。

在许多情况下，原始源代码已经被重新格式化；我们添加了换行并重新整理了缩进，以适应书中的可用页面空间。在极少数情况下，即使这样也不够，列表中包括行续续标记（➥）。此外，当代码在文本中描述时，源代码中的注释通常也会从列表中移除。许多列表都有代码注释，突出显示重要概念。

我在本书中对每个重要的示例都进行了注释，以突出重要概念并向读者解释每段代码的作用。

本书示例的代码也可以从 Manning 网站下载，网址为[www.manning.com/books/testing-javascript-applications](https://www.manning.com/books/testing-javascript-applications)。

### 系统要求

本书的所有代码示例都是在 macOS Catalina 上编写和测试的。然而，它们应该可以在所有平台上运行，包括 Linux 和 Windows。

为了使本书的示例运行，你可能需要做的唯一更改是根据你使用的 shell 和操作系统调整环境变量的设置方式。例如，如果你在 Windows 机器上使用 PowerShell，你不能仅仅在命令前加上`VAR_NAME=value`来设置环境变量的值。

要运行本书的示例，您必须在您的机器上安装 Node.js 和 NPM。这两者通常捆绑在一起。当您安装 Node.js 时，您通常也会获得 NPM。要下载和安装这两款软件，您可以遵循 [`nodejs.org/en/download/`](https://nodejs.org/en/download/) 上的说明。我在构建本书示例时使用的 Node.js 和 NPM 版本分别是 12.18 和 6.14。

### liveBook 讨论论坛

购买《Testing JavaScript Applications》包括免费访问由 Manning Publications 运营的私人网络论坛，您可以在论坛中就本书发表评论、提出技术问题，并从作者和其他用户那里获得帮助。要访问论坛，请访问 [`livebook.manning.com/#!/book/testing-javascript-applications/ discussion`](https://livebook.manning.com/#!/book/testing-javascript-applications/discussion)。您还可以在 [`livebook.manning.com/#!/discussion`](https://livebook.manning.com/#!/discussion) 了解更多关于 Manning 论坛和行为准则的信息。

Manning 对读者的承诺是提供一个场所，让读者之间以及读者与作者之间可以进行有意义的对话。这并不是对作者参与特定数量活动的承诺，作者对论坛的贡献仍然是自愿的（且未付费）。我们建议您尝试向作者提出一些挑战性的问题，以免他的兴趣转移！只要本书有售，论坛和先前讨论的存档将可通过出版社的网站访问。

## 关于作者

Lucas da Costa 是一名软件工程师、已出版作者、国际演讲者和专业问题解决者。作为开源社区的活跃成员，他是最受欢迎的 JavaScript 测试库 Chai 和 Sinon 的核心维护者。此外，他还为 Jest 和 NodeSchool 等众多其他项目做出了贡献。

在过去几年中，Lucas 在 10 多个国家的众多软件工程会议上进行了演讲。

他的内容自愿翻译成了多种语言，包括俄语、普通话、法语、葡萄牙语和西班牙语，并被用作世界各地多个软件工程课程的参考材料。

Lucas 喜欢有观点的书籍、漂亮的代码、精心设计的散文、命令行界面和 Vim。事实上，他如此热爱 Vim，以至于在他的脚踝上纹了一个 `:w`。

## 关于封面插图

《测试 JavaScript 应用程序》封面上的插图被标注为“巴黎市民”。这幅插图取自雅克·Grasset de Saint-Sauveur（1757–1810）的作品集，名为《Costumes civils de actuals de toue les peuples connus》，1788 年出版于法国。每一幅插图都是手工精心绘制和着色的。Grasset de Saint-Sauveur 收藏中的丰富多样性生动地提醒我们，仅仅 200 年前，世界各地的城镇和地区在文化上有多么不同。他们彼此孤立，说着不同的方言和语言。在街道或乡村，仅凭他们的着装，就可以轻易地识别出他们居住的地方以及他们的职业或社会地位。

自那以后，我们的着装方式已经改变，当时的地区多样性已经逐渐消失。现在很难区分不同大陆、不同城镇、地区或国家的人们。也许我们用更丰富多彩的个人生活——当然，是更丰富多彩、节奏更快的技术生活——来换取了文化多样性。

在这个难以区分一本计算机书籍与另一本的时代，曼宁通过基于两百年前丰富多样的地区生活的书封面，庆祝了计算机行业的创新精神和主动性，这些生活被 Grasset de Saint-Sauveur 的画作重新赋予了生命。
