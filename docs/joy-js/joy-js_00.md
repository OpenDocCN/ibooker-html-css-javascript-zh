# 前置内容

## 前言

我以传统、学术的方式学习编程。我所就读的大学主要基于以类为中心的语言，如 Java、C++和 C#。当我从这些课程毕业时，我的大脑被训练成认为类是设计程序的最佳（也许甚至是唯一）方式，而其他任何方式都是一种亵渎。

多年后，像世界上任何其他开发者一样，我偶然遇到了 JavaScript——我应该说是 jQuery，因为在当时，jQuery 就是 JavaScript。JavaScript 与我所学的几乎所有内容都截然相反。我在编程的每一个基本方面都遇到了挑战，包括表示领域模型、将行为和数据封装到逻辑模块中，以及处理事件和异步函数。我对自己的说，好吧，让我们使用 jQuery 和一系列第三方库来“修复语言”，并忘记这一切。

但 JavaScript 并不需要修复：我需要修复的是自己。我知道我无法摆脱它。因为 JavaScript 几乎无处不在，所以迟早我会再次遇到它，所以我决定更深入地探索它。了解其原型机制和闭包机制让我真正理解了面向对象编程的含义。当艾伦·凯在 21 世纪初发明这个术语时，他希望将诸如消息传递（对象向其他对象传递或发送消息）、封装（仅暴露必要的部分）和动态链接（在运行时通过名称解析对象的属性）等概念结合起来。与我所学的所有其他语言不同，JavaScript 将这些原则深深植根于其设计之中；更重要的是，这些概念对开发者来说易于访问。这时我才突然意识到，我终于理解了编程。

带着新发现的动力，我继续学习 JavaScript，发现了高阶函数，这让我对函数式编程和可组合软件有了新的认识。突然之间，编程不再令人沮丧；它成了一种乐趣。这种认识推动了我的职业生涯，使我成为《JavaScript 函数式编程》（Manning，2016）、《RxJS 实战》（Manning，2017）和现在《JavaScript 的乐趣》（Manning，2021）等书籍的作者。

这本书是为那些像我一样，有幸了解诸如闭包、原型和高级函数等惊人特性的开发者而写的。他们希望将这些特性提升到下一个层次，以便每天都能享受使用 JavaScript 的乐趣。《JavaScript 的乐趣》展示了这门语言本身所能提供的，而不需要任何第三方库和框架。由于围绕 JavaScript 的主题数量众多，这本书并没有花太多时间深入探讨基本概念（但提供了很好的资源）；它也不是编写 ECMAScript 2019、2020 等的指南。相反，它为你提供了对激动人心的主题、趋势和技术近距离的观察，这将使你能够掌握你可能不知道存在的语言领域。作为额外的好处，这本书还介绍了可能在几年内加入语言的一些新特性。了解这些提案是有价值的，这样你就能理解语言的发展方向以及它是如何演变的。

写这本书帮助我度过了这些不确定和焦虑的时光，我真诚地希望你在阅读它时能找到与我写作时同样的快乐。在撰写这份手稿的过程中，我对编程有了全新的认识，我希望它也能为你带来同样的收获。

## 致谢

这本书花费了很多精力。但我相信，所有这些努力都造就了一本优秀的书籍，它很好地补充了现有的内容，我希望你们也会这样认为。

我想感谢很多人在我成长过程中给予的帮助。

首先，我想感谢我的妻子，安娜。你一直支持我，总是耐心地照顾一切（包括我们两个了不起的儿子，卢克和马修），在我努力完成这本书的过程中。你总是让我相信我能完成它。我爱你。

接下来，我想感谢我在 Manning 的长期、无瑕疵的编辑，弗朗西斯·莱夫科维茨。感谢你与我合作，一路指导我，使写作过程变得愉快（更不用说还能忍受了）。你对这本书质量的承诺使得它对每一位读者来说都变得更好。还要感谢所有在 Manning 与我一起参与书籍生产和推广的其他同事：迪尔德丽·希姆和梅洛迪·多拉布。这确实是一个团队的努力。

我还要感谢在本书开发过程中不同阶段抽出时间阅读我的手稿并提供宝贵反馈的审阅者：Al Pezewski、Alberto Ciarlanti、Amit Lamba、Birnou Sébarte、Daniel Posey、Daniel Bretoi、Dary Merckens、Dennis Reil、Didier Garcia、Edwin Kwok、Foster Haines、Francesco Strazzullo、Gabriel Wu、Jacob Romero、Joe Justesen、Jon Guenther、Julien Pohie、Kevin Norman D. Kapchan、Kimberly Winston-Jackson、Konstantinos Leimonis、Jahred Love、Lora Vardarova、Matteo Gildone、Miranda Whurr、Nate Clark、Pietro Maffi、Rance Shields、Ray Booysen、Richard Michaels、Sachin Singhi、Satej Kumar Sahu、Srihari Sridharan、Ubaldo Pescatore 和 Víctor M. Pérez。

特别感谢 Cypress.io 工程副总裁 Gleb Bahmutov ([`twitter.com/bahmutov`](https://twitter.com/bahmutov)) 和 James Sinclair ([`twitter.com/jrsinclair`](https://twitter.com/jrsinclair)) 对本书和代码的深刻审阅。Gleb 和 James 是了不起的 JavaScript 拥护者，我强烈推荐您关注他们的工作。还要感谢我的兄弟 Carlos，他抽出时间阅读本书并提供了许多重要且建设性的反馈。

最后，我站在巨人的肩膀上。感谢 Kyle Simpson 在他的书系列《You Don’t Know JS》（[`github.com/getify/You-Dont-Know-JS`](https://github.com/getify/You-Dont-Know-JS)）中用正确的方式教我们 JavaScript，还要感谢 Eric Elliot 对可组合软件的独特见解（[`leanpub.com/composingsoftware`](https://leanpub.com/composingsoftware)）。还要感谢 Brendan Eich，没有他 JavaScript 就不会存在。您让工作变得如此快乐！

## 关于这本书

JavaScript 疲劳感是真实存在的——不仅因为程序员有超过一百万个 NPM 包可供选择，而且他们也有同样多的在线资源可以用来获取信息和指导。本书《JavaScript 的乐趣》旨在综合 JavaScript 语言中最前沿和最激动人心的进展，帮助您超越基础，达到下一个层次。本书首先比较和对比了突出 JavaScript 原型链和动态链接的对象建模技术。然后，它聚焦于高阶函数以及如何利用 JavaScript 的函数式编程能力来构建真正可组合的软件——这一主题以某种方式贯穿了整本书。接下来，本书分别探讨了使用模块和元编程进行静态和动态关注点分离。本书以讨论有效处理数据流异步流的方式结束。我希望这四部分旅程能帮助将疲劳转化为快乐。

谁应该阅读这本书

《JavaScript 的乐趣》是为已经具备坚实基础的专业开发者编写的，他们希望将知识面扩展到语言的其它部分——包括他们可能见过或听说过但从未有机会或时间学习的内容。尽管本书针对中级到高级开发者，但它温和地介绍了最困难的一些主题，因此也适合对 JavaScript 充满热情并愿意补充知识的初学者。

本书是如何组织的

每一章都为本书的目标做出贡献，即展示如何从简单、可组合的部件构建软件。章节被分为四个部分，每个部分从不同的角度审视 JavaScript：对象、函数、代码和数据。本书的四个部分涵盖了九个章节，应按顺序阅读，因为每个章节和部分都是建立在之前的一个基础之上的。为了给您一个更全面的了解，以下是每个部分的总结。

第一部分：对象

第一部分阐明了 JavaScript 的对象系统。对类声明的语法支持为您提供了一个干净、简单的方法来在领域模型中建立继承关系，以便您可以利用适当的数据封装并创建高度内聚、结构良好的领域。尽管添加了许多添加面向类特性的进步（如类、私有属性和继承），JavaScript 远非面向类语言；实际上，恰恰相反。底层原型机制使得 JavaScript 的对象系统极具可塑性、多功能性，并且比其他语言更加动态。

本部分向您介绍了帮助您构建和实例化领域模型实体的技术，并理解每种方法的优缺点。在本部分中，您将了解到尽管类在 JavaScript 中有其位置，但它们并不是建模对象的唯一方式，而且肯定不能反映 JavaScript 的工作方式。要精通这门语言，您必须理解对象系统是如何工作的。

第二部分：函数

在第一部分定义了我们的对象形状之后，在第二部分中，我们通过使用纯函数和组合来连接它们。函数为《JavaScript 的乐趣》增添了乐趣。JavaScript 拥有强大的函数式编程能力，使得函数成为计算的主要单元。信不信由你，函数一直是 JavaScript 最强大的部分。语言对高阶函数的支持是编写模块化、可组合和可维护软件的关键。

在本部分，您将学习如何使用以不可变性、纯度和代数数据类型（ADT）为中心的函数式编程（FP）原则来推动您应用程序的业务逻辑。您将函数置于设计的前端，以利用 JavaScript 最强大的功能：高阶函数。到这一点，您将精通现代 JavaScript 习惯用法，并且您将窥视到一些新的语言特性，如管道和绑定运算符。

第三部分：代码

在 JavaScript 中，一个缺乏的领域是标准化的、官方的模块系统。多年来，许多尝试都试图解决这个问题，但没有任何一种方法能够在客户端/服务器平台上很好地工作。通过借鉴所有这些尝试中的最佳之处，JavaScript 引入了 ECMAScript 模块（ESM）系统，也称为 ES6 模块。这个静态模块系统允许 JavaScript 运行时执行许多优化，并使构建工具更智能，使它们能够内省和分析您的代码结构，以创建最优化分布。

模块不是唯一分离可重用代码片段的方法。此外，您还将了解 JavaScript 的标准 API，这些 API 可以动态地连接到您的数据，称为 `Proxy` 和 `Reflect`。这些 API 允许您像专业人士一样分离关注点，并动态引入跨切面策略，如跟踪、日志记录和性能计数器，而无需修改或污染您的主应用程序逻辑。

第四部分：数据

网络发展迅速。现代软件架构的现实是，如今一切都是分布式的，以 API 驱动。作为网络的语言，JavaScript 拥有强大的构造、API 和语法来满足您的异步和流式编程需求。在本部分，您将了解承诺、`async`/`await`、异步迭代器、异步生成器、可观察流等等。

关于代码

本书包含许多源代码示例，无论是编号列表还是与普通文本内联。在两种情况下，源代码都使用 `fixed-width font like this` 格式化，以清楚地将其与普通文本区分开来。

在解析代码时，以下是一些需要注意的事项。

为了检查变量或对象属性的内容，本书经常将变量或属性引用后跟一个内联注释（`//`）来显示其值。在这些情况下，（`//`）表示等于或返回。以下是一个示例：

```
proxy.foo; // 'bar'
```

当从构造函数的原型中引用一个属性时，例如在 `Function.prototype.call` 中，使用 `#` 符号代替原型引用，如下所示：`Function#call.`

所有代码示例都假设 JavaScript 处于严格模式 (`"use strict";`)。如果您不知道这个术语的含义，请访问 [`mng.bz/goaE`](http://mng.bz/goaE)。

有时使用箭头函数来提高可读性，特别是对于旨在匿名或适合单行的函数。

为了使代码示例简短，本书经常省略不必要的细节，例如之前已显示的代码或读者无需太多努力就能理解的代码。在这些情况下，行内注释后面跟着省略号（`//...)`。

在许多情况下，原始源代码已被重新格式化；我已添加换行并重新整理缩进，以适应书中的可用页面空间。

伴随本书的代码与实际编码相符，但旨在简单，避免额外的复杂性。它的唯一目的是教学，因此不打算在生产系统中直接使用。

任何使用非官方未来语言部分的代码，都使用 Babel 将其转换为标准 JavaScript。本书不涵盖 Babel，但附录 A 提供了一个简要介绍。

本书示例的源代码托管在公共 GitHub 仓库中，并可从出版社网站 [`www.manning.com/books/the-joy-of-javascript`](https://www.manning.com/books/the-joy-of-javascript) 下载。要运行每一章的列表，你有两种选择：下载并安装 Node.js v14 或更高版本以在本地运行代码，或者使用提供的最小 Docker 配置（配置了一个带有 Node.js 14 的虚拟环境，并包含所有必需的项目配置）。如果你不想或不能升级你的环境，Docker 很方便。Docker 沙盒确保所有代码都能在没有你的系统配置或甚至你使用的操作系统的情况下运行。你可以在 [`www.docker.com/products/docker-desktop`](https://www.docker.com/products/docker-desktop) 为你的特定操作系统注册并下载 Docker 引擎。

其他在线资源

+   《你不知道的 JavaScript》，作者凯尔·辛普森 ([`github.com/getify/You-Dont-Know-JS`](https://github.com/getify/You-Dont-Know-JS))

+   《可组合软件》，作者埃里克·埃利奥特 ([`leanpub.com/composingsoftware`](https://leanpub.com/composingsoftware))

+   火狐开发者网络 ([`developer.mozilla.org/en-US`](https://developer.mozilla.org/en-US))

## 关于作者

| ![Atencio](img/Atencio.png)  | 路易斯·阿滕西奥 (@luijar) 是佛罗里达州劳德代尔堡 Citrix Systems 的主云工程师。他拥有计算机科学学士和硕士学位，现在全职使用 JavaScript 和 Java 开发和架构云网络应用程序。路易斯积极参与社区活动，并在全球会议和当地聚会中多次发表演讲。当他不在编码时，他写了一个专注于软件工程的开发者博客 ([`medium.com/@luijar`](https://medium.com/@luijar))。他还为 PHPArch 和 DZone 撰写了多篇文章。路易斯还是《JavaScript 函数式编程》（Manning，2016 年）的作者，以及《RxJS 实战》（Manning，2017 年）的合著者。 |
| --- | --- |

## 关于封面插图

《JavaScript 之乐》封面的插图上写着“Groenlandais”，即格陵兰人。这幅插图取自雅克·格拉塞·德·圣索沃尔（1757-1810）的作品集，名为《不同国家的服饰》，于 1797 年在法国出版。每一幅插图都是手工精心绘制和着色的。格拉塞·德·圣索沃尔收藏中的丰富多样性生动地提醒我们，200 年前世界的城镇和地区在文化上有多么不同。他们彼此孤立，说着不同的方言和语言。在街道或乡村，仅凭他们的服饰就能轻易识别他们居住的地方以及他们的职业或社会地位。

自那以后，我们的着装方式已经改变，而当时区域间的多样性，如此丰富，现在已经逐渐消失。现在很难区分不同大陆的居民，更不用说不同的城镇、地区或国家了。也许我们用文化多样性换取了更加丰富多彩的个人生活——当然，是更加丰富多彩和快节奏的技术生活。

在难以区分一本计算机书和另一本计算机书的今天，曼宁通过基于两百年前丰富多样的区域生活，并由格拉塞·德·圣索沃尔的图画使之重现的书封面，庆祝了计算机行业的创新精神和主动性。
